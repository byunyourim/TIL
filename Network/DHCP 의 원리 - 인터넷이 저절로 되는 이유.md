#### 카페 가서 와이파이를 연결할 때 어떻게 되는거지?

- 어떻게 내 장치에 네트워크 셋팅을 해주는거지? (그것도 무선으로)
- IP 주소가 다른 사람과 왜 안 겹치지?
- 누가 나한테 IP를 주는거지?


<br><br><br>

## wifi의 SSID
와이파이는 눈에 보이지 않는다. 따라서 어디에 어디에 연결하는지 구분할 필요가 있다.  

그래서 생긴 것이 SSID(Service Set Identifier)이 생겼다.  

내가 누구라고 말할테니 나를 보고 식별해서 들어오세요.
이렇게 무선으로 광고하는 것이다.  

그래서 퍼블릭한 특징을 갖는다.  




<br><br><br>

## SSID 를 선택하면 일어나는 일
SSID를 하나 고르면 어떻게 될까?

알맞은 비밀번호를 입력한다. 그리고 인터넷에 연결된다.  




<br><br><br>

## WIFI에 연결하면 첫 순간, DHCP가 작동 합니다.
Dynamic Host Configuration Protocol  

DHCP는 네트워크 라우터(공유기)에서 지원하는 기능을 나의 네트워크에 
입성하고 하는 장치들에게 **IP를 동적으로 부여해주는 기능**이다.
  
  
그리고 CIDR로 정해진 내 IP 범위 안에서, 겹치지 않게 미사용 IP를 관리하고 나눠준다.  



<br><br><br>

## DHCP 의 동작 원리
여기서 TCP/IP 의 재밌는 기능이 사용 됩니다.  
  
여러분 혹시 브로드캐스트 IP (Broadcast IP) 라는 주소를 들어보셨나요?
아니라면, 이런 IP 보신적 있으신가요?
255.255.255.255

위 IP는 주소의 모든 Bit가 1로 채워진, 가용 범위중 가장 마지막 IP 입니다.  
이 IP는 특수한 IP로 사용되고 브로드캐스트 IP라고 해요.  

브로드 캐스팅 IP는 방송용 IP라고 할 수 있다.  

이 네트워크에 연결된 모두에게 방송을 한다.  

네트워크에서 서로 통신하려면 서로 IP를 알아야 한다.  
그런데, 이 IP로 송신하면?  
이 네트워크 안에 있는 모두에게 다 보낸다.  


그런데, 방송 할 때 바로 DHCP를 쓴다.


<br><br><br>

## 그래서, DHCP가 IP를 받는 방법
#### 네트워크에 연결 하고 싶은 사람이 SSID로 일단 무선 연결을 시도한다.  
- 이때는 TCP/IP가 아니라 꽤 복잡한 IEEE 802.11 프로토콜 같은걸 써요.
- 아무튼 아직은 DHCP를 안씁니다.

#### 위의 과정으로 무선 연결이 설정되면, DHCP를 사용한다.
- 255.255.255.255 로 메세지를 날립니다.
- 나) “저한테 IP주소 주실분”
- 이런 메세지를 DHCP Discover 메세지라고 해요.

#### 이제 네트워크 안에 있는 DHCP 서버가 듣고 호텔 카운터 처러 응답을 한다.
- DHCP) 오~ 환영합니다 신규고객님
- DHCP) 192.168.0.101 이 마침 있는데 빌려드릴까요?  

- 나) 오, 번호 좋네요 그럼 제가 쓰겠습니다.  

- DHCP) 네 고객님, 그럼 192.168.0.101 사용하시고요…
- DHCP) 반납 시간은 1시간 후 입니다!  

- 나) 넵! 감사합니다. (근데 왜 한시간…)


내가 계속 쓴다고 연장을 해야 한다.  
하지만 OS가 알아서 하기 때문에 신경쓰지 않아도 된다.

<br><br><br>


공유기 외에도 집에서 이용하는 통신사의 인터넷 서비스도 DHCP를 사용한다.
(유동 IP 서비스라고 하죠.)

이 경우 브로드캐스팅에 응답하는 DHCP 서버는 아파트 어딘가에 설치된 통신사 장비 안에 있다.
255.255.255.255 에 빠르게 응답해야 고객 클레임이 없기 때문이죠.
  
(네트워크에 따라 이 주소는 다를 수 있지만, IPv4에서는 항상 서브넷 브로드캐스트 주소의 끝이 255입니다.)
아참, 유선 LAN 은 어떻게 되냐고요?
유선 LAN도 완전 똑같습니다. 공유기에 LAN 선을 뽑아 내 PC에 꼽는 순간 DHCP가 작동한다.

AWS에도 VPC의 서브넷이 이 DHCP 기능을 가지고 있습니다.
그래서 EC2 인스턴스 를 만들면 IP가 자동으로 부여되죠.
또한 도커에서도 bridge 네트워크가 이 역할을 합니다.
(사실, 도커는 DHCP는 아니고 자체 규격을 쓰지만 IP를 동적으로 부여하는 것은 똑같습니다.)


