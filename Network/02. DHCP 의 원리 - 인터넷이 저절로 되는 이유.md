#### 카페 가서 와이파이를 연결할 때 어떻게 되는거지?

- 어떻게 내 장치에 네트워크 셋팅을 해주는거지? (그것도 무선으로)
- IP 주소가 다른 사람과 왜 안 겹치지?
- 누가 나한테 IP를 주는거지?


<br><br><br>

## wifi의 SSID
와이파이는 눈에 보이지 않는다. 따라서 어디에 어디에 연결하는지 구분할 필요가 있다.  

그래서 생긴 것이 SSID(Service Set Identifier)이 생겼다.  

내가 누구라고 말할테니 나를 보고 식별해서 들어오세요.
이렇게 무선으로 광고하는 것이다.  

그래서 퍼블릭한 특징을 갖는다.  

>  **SSID:** 라우터 설정 시 Wi-Fi 네트워크에 할당되는 이름
> 라우터는 데이터를 전송하고 네트워크 연결을 관리하는 장비입니다.
> 우리는 SSID를 통해 라우터가 제공하는 Wi-Fi 네트워크를 식별하고 연결합니다.



<br><br><br>

## SSID 를 선택하면 일어나는 일
SSID를 하나 고르면 어떻게 될까?

알맞은 비밀번호를 입력한다. 그리고 인터넷에 연결된다.  




<br><br><br>

## WIFI에 연결하면 첫 순간, DHCP가 작동 합니다.
Dynamic Host Configuration Protocol  

DHCP는 네트워크 라우터(공유기)에서 지원하는 기능을 나의 네트워크에 
입성하고 하는 장치들에게 **IP를 동적으로 부여해주는 기능**이다.
  
  
그리고 CIDR로 정해진 내 IP 범위 안에서, 겹치지 않게 미사용 IP를 관리하고 나눠준다.  



<br><br><br>

## DHCP 의 동작 원리

브로드캐스트 IP가 사용된다.

(255.255.255.255)
브로드캐스트 IP는 주소의 모든 Bit가 1로 채워진, 가용 범위중 가장 마지막 IP 입니다.  
이 IP는 특수한 IP로 사용되고 브로드캐스트 IP이다. 

브로드 캐스팅 IP는 방송용 IP로, 네트워크에 연결된 모두에게 방송을 한다.  
  
네트워크에서 서로 통신하려면 서로 IP를 알아야 한다.  
그런데, 이 IP로 송신하면?  
이 네트워크 안에 있는 모두에게 다 보낸다.  


그런데, 방송 할 때 바로 DHCP를 쓴다.

> ### 브로드캐스트 IP
> 네트워크 내 모든 장치에 메시지를 전송하여, DHCP서버가 클라이언트를 발견할 수 있도록 도와준다.    
> 이를 통해 네트워크에 있는 모든 DHCP 서버가 요청에 응답할 수 있게 되어, 클라이언트는 적절한 IP 주소를 할당받을 수 있다.


<br><br><br>

## 그래서, DHCP가 IP를 받는 방법
#### 네트워크에 연결 하고 싶은 사람이 SSID로 일단 무선 연결을 시도한다.  
- 이때는 TCP/IP가 아니라 꽤 복잡한 IEEE 802.11 프로토콜 같은걸 써요.
- 아무튼 아직은 DHCP를 안씁니다.

#### 위의 과정으로 무선 연결이 설정되면, DHCP를 사용한다.
- 255.255.255.255 로 메세지를 날립니다.
- 나) “저한테 IP주소 주실분”
- 이런 메세지를 DHCP Discover 메세지라고 해요.

#### 이제 네트워크 안에 있는 DHCP 서버가 듣고 응답을 한다.
- DHCP) 오~ 환영합니다 신규고객님
- DHCP) 192.168.0.101 이 마침 있는데 빌려드릴까요?  

- 나) 오, 번호 좋네요 그럼 제가 쓰겠습니다.  

- DHCP) 네 고객님, 그럼 192.168.0.101 사용하시고요~
- DHCP) 반납 시간은 1시간 후 입니다!  

- 나) 넵! 감사합니다. 근데 왜 한시간?


내가 계속 쓴다고 연장을 해야 한다.  
하지만 OS가 알아서 하기 때문에 신경쓰지 않아도 된다.

<br><br><br>


공유기 외에도 집에서 이용하는 통신사의 인터넷 서비스도 DHCP를 사용한다.
(유동 IP 서비스라고 하죠.)

이 경우 브로드캐스팅에 응답하는 DHCP 서버는 아파트 어딘가에 설치된 통신사 장비 안에 있다.
255.255.255.255 에 빠르게 응답해야 고객 클레임이 없기 때문이다.
  
(네트워크에 따라 이 주소는 다를 수 있지만, IPv4에서는 항상 서브넷 브로드캐스트 주소의 끝이 255입니다.)

<br>

### 유선 LAN 은 어떻게 될까?
유선 LAN도 같다. 공유기에 LAN 선을 뽑아 내 PC에 꼽는 순간 DHCP가 작동한다.

AWS에도 VPC의 서브넷이 이 DHCP 기능을 가지고 있습니다.
그래서 EC2 인스턴스 를 만들면 IP가 자동으로 부여되죠.
또한 도커에서도 bridge 네트워크가 이 역할을 합니다.
(사실, 도커는 DHCP는 아니고 자체 규격을 쓰지만 IP를 동적으로 부여하는 것은 똑같습니다.)



<br><br>


### DHCP와 정적 IP 주소 할당의 차이
DHCP는 네트워크 장치에 IP 주소를 자동으로 동적으로 할당하는   
반면, 정적 IP주소의 할당은 각 장치에 수동으로 고정된 IP 주소를 설정하여 사용한다.



<br><br>


### DHCP의 주요 구성 요소
- **DHCP 서버:** IP 주소와 네트워크 구성 정보를 클라이언트에게 할당하는 역할을 합니다.
- **DHCP 클라이언트:** 네트워크에 연결되어 IP 주소와 설정 정보를 요청하는 장치입니다.
- **IP 주소 풀:** DHCP 서버가 클라이언트에게 할당할 수 있는 사용 가능한 IP 주소의 집합입니다.
- **스코프:** 특정 네트워크 세그먼트에 대해 DHCP 서버가 관리하는 IP 주소의 범위를 정의합니다.
- **DHCP 메시지:** 클라이언트와 서버 간에 주고받는 다양한 메시지(Discover, Offer, Request, Acknowledgment 등)입니다.


<br><br>


#### DHCP 장점
IP 주소 관리의 자동화로 인해 수동 설정의 번거로움을 줄이고, IP주소 충돌의 위험을 최소화 한다.
그리고, 네트워크에 새로운 장치가 쉽게 연결될 수 있도록하여 관리의 효율성을 향상시킨다.


<br><br>



### DHCP 릴리스
클라이언트가 더 이상 IP를 필요로 하지 않아, 해당 IP 주소를 DHCP 서버에 반환하는 과정으로 주로 클라이언트가 네트워크에서 로그아웃하거나 이동할 때 발생한다.
  
이 과정을 통해 사용되지 않는 주소를 다시 주소풀로 반환하여 다른 클라이언트가 사용할 수 있도록 하여, 이로써 주소 부족 문제를 방지하여 네트워크 자원을 최적화한다.
  
또한, 네트워크 환경이 변할 때, 클라이언트가 새로운 네트워크 설정을 요청할 수 있도록 하여 유연성을 제공합니다.


<br><br>


### DHCP 서버가 다운된 경우
클라이언트는 이전에 할당받은 IP 주소를 유지하며, DHCP 서버가 복구될 때까지 해당 IP 주소를 계속 사용하거나, 네트워크에 새로 연결되어 IP 주소를 갱신하려고 한다.
  
클라이언트는 주기적으로 DHCP 서버에 요청을 재시도하지만, 서버가 다운된 상태가 지속되면 요청은 계속 실패한다.  
    
이렇듯 클라이언트가 DHCP 서버로부터 IP 주소를 받을 수 없는 경우, 네트워크 관리자는 수동으로 정적 IP 주소를 설정하여 연결할 수 있도록 한다.

